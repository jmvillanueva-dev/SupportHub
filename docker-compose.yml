version: "3.8"

services:
  # --- VERSIÓN SEGURA (Vulnerabilidades Corregidas) ---
  supporthub_secure:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: supporthub-secure
    ports:
      - "3001:3000" # Puerto externo 3001 para no interferir con la versión vulnerable
    environment:
      - NODE_ENV=production
    volumes:
      - supporthub-secure-data:/app/data # Volumen separado
    networks:
      - secure_net
    restart: unless-stopped

  # --- KALI PARA PRUEBAS (opcional) ---
  kali_tester:
    image: kalilinux/kali-rolling
    container_name: kali_secure
    tty: true
    stdin_open: true
    networks:
      - secure_net

networks:
  secure_net:
    driver: bridge

volumes:
  supporthub-secure-data:
# ============================================
# SupportHub - VERSIÓN SEGURA (Fix Branch)
# Vulnerabilidades Corregidas - Uso Educativo
# ============================================
#
# Iniciar (desde rama feature/fix-bug):
#   docker-compose up -d --build
#
# Acceder:
#   http://localhost:3001   (Versión SEGURA)
#   http://localhost:3000   (Versión vulnerable - otra rama)
#
# Entrar a Kali:
#   docker exec -it kali_secure /bin/bash
#
# Para ejecutar AMBAS versiones simultáneamente:
#   1. En rama main:          docker-compose up -d --build
#   2. En rama feature/fix-bug: docker-compose up -d --build
# ============================================

